<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8">
    
    <title>Enable HA for HiveServer2 | Amit Anand</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="In this blog I am going to show you how to enable High Availability for HiveServer2. The HiveServer2, like HDFS NameNode, does not have any limit on number of servers that can be added to HA configura">
<meta property="og:type" content="article">
<meta property="og:title" content="Enable HA for HiveServer2">
<meta property="og:url" content="http://blog.amitanand.net/2016/07/09/hive-ha/index.html">
<meta property="og:site_name" content="Amit Anand">
<meta property="og:description" content="In this blog I am going to show you how to enable High Availability for HiveServer2. The HiveServer2, like HDFS NameNode, does not have any limit on number of servers that can be added to HA configura">
<meta property="og:updated_time" content="2016-07-09T20:10:35.086Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Enable HA for HiveServer2">
<meta name="twitter:description" content="In this blog I am going to show you how to enable High Availability for HiveServer2. The HiveServer2, like HDFS NameNode, does not have any limit on number of servers that can be added to HA configura">
    

    

    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/open-sans/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
    

</head>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                
                <span class="site-title">Amit Anand</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/logo.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/logo.png" />
            <h2 id="name">Amit Anand</h2>
            <h3 id="title">Hadoop Administrator</h3>
            <span id="location"><i class="fa fa-map-marker"></i>New York, USA</span>
            <a id="follow" target="_blank" href="https://github.com/amithkanand/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                1
                <span>post</span>
            </div>
            <div class="article-info-block">
                5
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/amithkanand" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://twitter.com/aanand59" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-hive-ha" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Enable HA for HiveServer2
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/07/09/hive-ha/">
            <time datetime="2016-07-09T20:10:35.094Z" itemprop="datePublished">2016-07-09</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Hive/">Hive</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/HIVEQL/">HIVEQL</a>, <a class="tag-link" href="/tags/HS2/">HS2</a>, <a class="tag-link" href="/tags/Hive/">Hive</a>, <a class="tag-link" href="/tags/Hiveserver2/">Hiveserver2</a>, <a class="tag-link" href="/tags/SQL/">SQL</a>
    </div>

                    </div>
                
            </header>
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>In this blog I am going to show you how to enable <strong>High Availability</strong> for <strong>HiveServer2</strong>. The <strong>HiveServer2</strong>, like <strong>HDFS NameNode</strong>, does not have any limit on number of servers that can be added to <strong>HA</strong> configuration. Also it doesn’t provide any failover mechanism. A client will have to reconnect, in case a connetion to current <strong>HiveServer2</strong> is lost. Below are the requirements to enable <strong>High Availability</strong> for <strong>HiveServer2</strong>.<br><a id="more"></a></p>
<h4 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h4><p>Zookeeper is used to store information about each <strong>HS2</strong> instarnce that is launched and registered with Zookeeper. A client, upon connection request, gets one of the registered <strong>HS2</strong> instance.</p>
<h4 id="Multiple-HiveServer2-instances"><a href="#Multiple-HiveServer2-instances" class="headerlink" title="Multiple HiveServer2 instances"></a>Multiple HiveServer2 instances</h4><p>To enable HA more than one instance of <strong>HS2</strong> is required. Multiple instances can run either on the same server with different port for each instance or on two different machines using same port number. If one of the instance fails, Zookeeper will return the next active <strong>HS2</strong> instance. Running multiple instances provides following benefits:</p>
<ul>
<li>High Availability</li>
<li>Load Balancing</li>
<li>Rolling Upgrade<blockquote>
<p><em>It is also possible to have  <strong>HS2</strong> instances configured with different authentication scheme. For example, four instances can be configured with first two instances running on port 10000 using <strong>Kerberos</strong> authentication and other two running on port 10001 using <strong>LDAP</strong> authentication.</em></p>
</blockquote>
</li>
</ul>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>Let’s look at the configuration that is needed for running multiple instances of <strong>HS2</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>hive.zookeeper.quorum</td>
<td>The list of Zookeeper servers to talk to.</td>
</tr>
<tr>
<td>hive.zookeeper.session.timeout</td>
<td>Zookeeper client’s session timeout. The client is disconnected, and as a result, all locks released, if a heartbeat is not sent in the timeout</td>
</tr>
<tr>
<td>hive.zookeeper.namespace</td>
<td>The parent node under which all Zookeeper nodes are created.</td>
</tr>
<tr>
<td>hive.server2.support.dynamic.service.discovery</td>
<td>Set to true to enable HiveServer2 dynamic service discovery for its clients</td>
</tr>
</tbody>
</table>
<h5 id="Sample-configuration"><a href="#Sample-configuration" class="headerlink" title="Sample configuration:"></a>Sample configuration:</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>f-bcpc-vm1.bcpc.example.com:2181,f-bcpc-vm2.bcpc.example.com:2181,f-bcpc-vm3.bcpc.example.com:2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.session.timeout<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>600000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.namespace<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>hiveserver2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.support.dynamic.service.discovery<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>
<p>At this stage after adding the configuration restart <strong>HiveServer2</strong> instance. Please do take a moment to look at <strong>Znodes</strong> created under <code>/hiveserver2</code> in <strong>Zookeeper</strong>.</p>
<p>After enabling HA one can connect to <strong>HS</strong> using syntax given below:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">ubuntu@bcpc-vm8:~$ beeline -u  <span class="string">"jdbc:hive2://f-bcpc-vm1.bcpc.example.com:2181,f-bcpc-vm2.bcpc.example.com:2181,f-bcpc-vm3.bcpc.example.com:2181/default;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2;principal=hive/f-</span></div><div class="line">bcpc-vm3.bcpc.example.com@BCPC.EXAMPLE.COM"</div><div class="line">Connecting to jdbc:hive2://f-bcpc-vm1.bcpc.example.com:2181,f-bcpc-vm2.bcpc.example.com:2181,f-bcpc-vm3.bcpc.example.com:2181/default;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2;principal=hive/f-bcpc-vm3.bcpc.exam</div><div class="line">ple.com@BCPC.EXAMPLE.COM</div><div class="line">Connected to: Apache Hive (version 1.2.1.2.3.4.0-3485)</div><div class="line">Driver: Hive JDBC (version 1.2.1.2.3.4.0-3485)</div><div class="line">Transaction isolation: TRANSACTION_REPEATABLE_READ</div><div class="line">Beeline version 1.2.1.2.3.4.0-3485 by Apache Hive</div><div class="line">0: jdbc:hive2://f-bcpc-vm1.bcpc.example.com:2&gt; select * from <span class="built_in">test</span> <span class="built_in">limit</span> 10;</div><div class="line">+----------+-------------+--+</div><div class="line">| test.id  | test.idval  |</div><div class="line">+----------+-------------+--+</div><div class="line">| id0001   | value0001   |</div><div class="line">| id0002   | value0002   |</div><div class="line">| id0003   | value0003   |</div><div class="line">| id0004   | value0004   |</div><div class="line">| id0005   | value0005   |</div><div class="line">| id0006   | value0006   |</div><div class="line">| id0007   | value0007   |</div><div class="line">| id0008   | value0008   |</div><div class="line">| id0009   | value0009   |</div><div class="line">| id0010   | value0010   |</div><div class="line">+----------+-------------+--+</div><div class="line">10 rows selected (2.102 seconds)</div></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://blog.amitanand.net/2016/07/09/hive-ha/" data-id="ciqfjb15q00000mrewz0rvny0" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://blog.amitanand.net/2016/07/09/hive-ha/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://blog.amitanand.net/2016/07/09/hive-ha/">Comments</a>
    

        </footer>
    </div>
    
        

    
</article>


    
    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Hive/">Hive</a></p>
                            <p class="item-title"><a href="/2016/07/09/hive-ha/" class="title">Enable HA for HiveServer2</a></p>
                            <p class="item-date"><time datetime="2016-07-09T20:10:35.094Z" itemprop="datePublished">2016-07-09</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Hive/">Hive</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/HIVEQL/" style="font-size: 10px;">HIVEQL</a> <a href="/tags/HS2/" style="font-size: 10px;">HS2</a> <a href="/tags/Hive/" style="font-size: 10px;">Hive</a> <a href="/tags/Hiveserver2/" style="font-size: 10px;">Hiveserver2</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2016 Amit Anand<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'http://blog.amitanand.net/2016/07/09/hive-ha/';
        
        this.page.identifier = 'hive-ha';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'hexo-theme-icarus' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>